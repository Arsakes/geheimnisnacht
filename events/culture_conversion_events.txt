#################################################
#
# CULTURAL CONVERSION EVENTS
#
#################################################
#
# modified by pietrko for Warhammer mod
# TODO currently it doesn't work for non human cultures!

# Province culture changes
province_event = {
    id = 55000
    desc = "EVTDESC55000"
    picture = GFX_evt_stone_church
    
    trigger = {
        owner = {
            top_liege = {
                culture = PREV
            }
            NOT = { culture = ROOT }
            religion = ROOT
        }
        any_neighbor_province = {
            has_owner = yes
            ROOT = {
                owner = {
                    culture = PREVPREV
                }
            }
            owner = {
                ROOT = {
                    owner = {
                        culture = PREVPREV
                    }
                }
            }
        }
        # FIXME
        NOT = { # doesn't work for non human cultures
            ROOT = {
                OR = {
                    culture_group = asur_group
                    culture_group = druchi_group
                    culture_group = orc_group
                    culture_group = nehekharan_group
                    culture_group = dwarf_group
                    culture_group = dwarf_chaos_group
                    culture_group = goblin_group
                    culture_group = skaven_group
                    culture_group = asrai_group
                }
            }
        }
    }
    
    mean_time_to_happen = {
        months = 1200

        modifier = {
            factor = 1.5
            owner = { NOT = { stewardship = 2 } }
        }
        modifier = {
            factor = 1.5
            owner = { NOT = { stewardship = 3 } }
        }
        modifier = {
            factor = 1.5
            owner = { NOT = { stewardship = 4 } }
        }
        modifier = {
            factor = 1.5
            owner = { NOT = { stewardship = 5 } }
        }
        modifier = {
            factor = 0.75
            owner = { stewardship = 9 }
        }
        modifier = {
            factor = 0.75
            owner = { stewardship = 11 }
        }
        modifier = {
            factor = 0.75
            owner = { stewardship = 13 }
        }
        modifier = {
            factor = 0.75
            owner = { stewardship = 15 }
        }
        modifier = {
            factor = 0.4 # nomad bonus vs non-nomad on steppe terrain
            owner = {
                OR = {
                    culture_group = hung_group
                    culture_group = kurgan_group
                }
            }
            OR = {
                owner = {
                    is_capital = ROOT
                }
                AND = {
                    NOT = { culture_group = hung_group }
                    NOT = { culture_group = kurgan_group }
                    terrain = steppe
                }
            }
        }
        modifier = {
            factor = 0.6 # bonus for kislevite as new expanding common culture for kislev
            owner = {
                culture = kislevite
            }
            culture_group = kislevite_group
        }
        modifier = {
            factor = 0.75
            owner = {
                OR = {
                    primary_title = {
                        conquest_culture = PREV
                    }
                    ROOT = {
                        county = {
                            conquest_culture = PREVPREV
                        }
                    }
                    ROOT = {
                        duchy = {
                            holder_scope = {
                                character = PREVPREVPREV
                            }
                            conquest_culture = PREVPREV
                        }
                    }
                    ROOT = {
                        kingdom = {
                            holder_scope = {
                                character = PREVPREVPREV
                            }
                            conquest_culture = PREVPREV
                        }
                    }
                    ROOT = {
                        empire = {
                            holder_scope = {
                                character = PREVPREVPREV
                            }
                            conquest_culture = PREVPREV
                        }
                    }
                }
            }
        }
    }

    option = {
        name = "EVTOPTA55000"
        owner = {
            # change target province to current scope (prov to owner culture)
            reverse_culture = ROOT
        }
    }
}

# Bring in some settlers
province_event = {
    id = 55001
    desc = "EVTDESC55001"
    picture = GFX_evt_stone_church
    
    only_rulers = yes
    
    trigger = {
        owner = {
            top_liege = {
                culture = PREV
            }
            NOT = { culture = ROOT }
            capital_scope = {
                province_id = ROOT
            }
            
            OR = {
                primary_title = {
                    conquest_culture = PREV
                }
                ROOT = {
                    county = {
                        conquest_culture = PREVPREV
                    }
                }
                ROOT = {
                    duchy = {
                        holder_scope = {
                            character = PREVPREVPREV
                        }
                        conquest_culture = PREVPREV
                    }
                }
                ROOT = {
                    kingdom = {
                        holder_scope = {
                            character = PREVPREVPREV
                        }
                        conquest_culture = PREVPREV
                    }
                }
                ROOT = {
                    empire = {
                        holder_scope = {
                            character = PREVPREVPREV
                        }
                        conquest_culture = PREVPREV
                    }
                }
            }
        }
        
        NOT = { # Exclude provinces covered by event 55000
            any_neighbor_province = {
                has_owner = yes
                ROOT = {
                    owner = {
                        culture = PREVPREV
                    }
                }
                owner = {
                    ROOT = {
                        owner = {
                            culture = PREVPREV
                        }
                    }
                }
            }
        }

        NOT = { # doesn't work for non human cultures
            ROOT = {
                OR = {
                    culture_group = asur_group
                    culture_group = druchi_group
                    culture_group = orc_group
                    culture_group = nehekharan_group
                    culture_group = dwarf_group
                    culture_group = dwarf_chaos_group
                    culture_group = goblin_group
                    culture_group = skaven_group
                    culture_group = asrai_group
                }
            }
        }
    }
    
    mean_time_to_happen = {
        months = 1200
        
        modifier = {
            factor = 1.5
            owner = { NOT = { stewardship = 2 } }
        }
        modifier = {
            factor = 1.5
            owner = { NOT = { stewardship = 3 } }
        }
        modifier = {
            factor = 1.5
            owner = { NOT = { stewardship = 4 } }
        }
        modifier = {
            factor = 1.5
            owner = { NOT = { stewardship = 5 } }
        }
        modifier = {
            factor = 0.75
            owner = { stewardship = 9 }
        }
        modifier = {
            factor = 0.75
            owner = { stewardship = 11 }
        }
        modifier = {
            factor = 0.75
            owner = { stewardship = 13 }
        }
        modifier = {
            factor = 0.75
            owner = { stewardship = 15 }
        }
        modifier = {
            factor = 0.4 # nomad bonus vs non-nomad on steppe terrain
            owner = {
                OR = {
                    culture_group = hung_group
                    culture_group = kurgan_group
                }
            }
            OR = {
                owner = {
                    is_capital = ROOT
                }
                AND = {
                    NOT = { culture_group = hung_group }
                    NOT = { culture_group = kurgan_group }
                    terrain = steppe
                }
            }
        }
        modifier = {
            factor = 0.6 # bonus for kislevite as new expanding common culture for kislev
            owner = {
                culture = kislevite
            }
            culture_group = kislevite_group
        }
    }

    option = {
        name = "EVTOPTA55001"
        owner = {
            reverse_culture = ROOT
            if = {
                limit = {
                    NOT = { religion = ROOT }
                }
                reverse_religion = ROOT
            }
        }
    }
}

# The English Melting Pot DELETED
#    id = 55002

# It's spreading DELETED (english stuff)
#    id = 55003

#Make my court speak English
#    id = 55004

#Make my vassal speak English
#    id = 55005


#id=55006


# A ruler is assimilated by the local culture
character_event = {
    id = 55010
    desc = "EVTDESC55010"
    picture = GFX_evt_stone_church
    
    only_rulers = yes
    min_age = 16
    capable_only = yes
    prisoner = no
    
    trigger = {
        NOT = { has_dlc = "Rajas of India" } # Controlled by Decision: convert_to_local_culture
        primary_title = { 
            NOT = { conquest_culture = ROOT } 
            NOT = { culture = ROOT }
            any_previous_holder = {
                NOT = { character = ROOT } # The first holder of a title does not convert
            }
        }
        capital_scope = {
            NOT = { culture = ROOT }
        }
        top_liege = {
            OR = {
                character = ROOT
                ROOT = { 
                    capital_scope = {
                        culture = PREVPREV
                    }
                }
            }
        }
    }
    
    mean_time_to_happen = {
        months = 1200
        modifier = {
            factor = 0.5
            top_liege = {
                NOT = { character = ROOT }
                ROOT = { 
                    capital_scope = {
                        culture = PREVPREV
                    }
                }
            }
        }
        modifier = {
            factor = 0.5
            primary_title = {
                ROOT = {
                    capital_scope = {
                        culture = PREVPREV
                    }
                }
            }
        }
        modifier = {
            factor = 2.0
            capital_scope = {
                culture_group = ROOT # Same culture group: slower assimilation
            }
        }
    }

    option = {
        name = "EVTOPTA55010"
        
        # Piss off the appropriate vassals
        any_vassal = {
            limit = {
                culture = ROOT
                age = 16
            }
            opinion = {
                who = ROOT
                modifier = opinion_adopted_foreign_ways
                years = 10
            }
            hidden_tooltip = { character_event = { id = 55011 days = 0 } }
        }
        
        capital_scope = {
            reverse_culture = ROOT
        }
    }
    
    option = {
        name = "EVTOPTB55010"
        ai_chance = {
            factor = 0
        }
    }
}


character_event = {
    id = 55011
    desc = "EVTDESC55011"
    picture = GFX_evt_scandal

    is_triggered_only = yes

    option = {
        name = "EVTOPTA55011"
        tooltip = {
            opinion = {
                who = FROM
                modifier = opinion_adopted_foreign_ways
                years = 10
            }
        }
    }
}
