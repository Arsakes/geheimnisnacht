namespace = ice
# 
# SPELLS FOR KISLEV ICE MAGES
#
###################################################
#
# STRATEGIC SPELLS MAIN EVENT
# Spell choosing event for decision triggered spells
#
###################################################
character_event = {
    id = ice.0
    desc = "EVTDESC_ICE_0"
    picture = "GFX_spell_ice"
    is_triggered_only = yes

    # channeling for strategic spells if any
    immediate = { 
        # spell test
        character_event = { id = magicengine.1 }
    }
    # Blizzard
    option = {
        # checking if casting is possible 
        trigger = {
            OR = {
                trait = magic_power_lord
                trait = magic_power_archmaster
            }
            NOT = { has_character_flag = strategic_spell_used }
        }
        name = "EVTOPT_ICE_0A" #Cast Blizzard
        # triggering spell event 
        if = {
            limit = { has_character_flag = last_spell_success }
            character_event = { id = ice.1 }
        }
        # failure of spellcast trigger failure report
        if = {
            limit = { NOT = { has_character_flag = last_spell_success } }
            character_event = { id = magicengine.11 }
        }
        # clear stuff
        clr_character_flag = last_spell_success 
    }
    # Ice walls
    option = {
        # checking if casting is possible 
        trigger = {
            OR = {
                trait = magic_power_magister
                trait = magic_power_lord
                trait = magic_power_archmaster
            }
            NOT = { has_character_flag = strategic_spell_used }
        }
        name = "EVTOPT_ICE_0B" #Cast Winter Realm"
        character_event = { id = magicengine.1 }
        # triggering spell event 
        if = {
            limit = { has_character_flag = last_spell_success }
            character_event = { id = ice.2 }
        }
        # failure of spellcast trigger failure report
        if = {
            limit = { NOT = { has_character_flag = last_spell_success } }
            character_event = { id = magicengine.11 }
        }
        # clear stuff
        clr_character_flag = last_spell_success 
    }
    # In Siege strategic spell 
    option = {
        # checking if casting is possible 
        trigger = {
            OR = {
                trait = magic_power_magister
                trait = magic_power_lord
                trait = magic_power_archmaster
            }
            in_siege = yes
            siege = { is_attacker = no }
            NOT = { has_character_flag = strategic_spell_used }
        }
        name = "EVTOPT_ICE_0C" #Cast Hail"
        character_event = { id = magicengine.1 }
        # triggering spell event 
        if = {
            limit = { has_character_flag = last_spell_success }
            character_event = { id = ice.3 }
        }
        # failure of spellcast trigger failure report
        if = {
            limit = { NOT = { has_character_flag = last_spell_success } }
            character_event = { id = magicengine.11 }
        }
        # clear stuff
        clr_character_flag = last_spell_success 
    }
    # In Siege (Attacker) strategic spell 
    option = {
        # checking if casting is possible 
        trigger = {
            OR = {
                trait = magic_power_magister
                trait = magic_power_lord
                trait = magic_power_archmaster
            }
            in_siege = yes
            siege = { is_attacker = yes }
            NOT = { has_character_flag = strategic_spell_used }
        }
        name = "EVTOPT_ICE_0D"
        character_event = { id = magicengine.1 }
        # triggering spell event 
        if = {
            limit = { has_character_flag = last_spell_success }
            character_event = { id = ice.4 }
        }
        # failure of spellcast trigger failure report
        if = {
            limit = { NOT = { has_character_flag = last_spell_success } }
            character_event = { id = magicengine.11 }
        }
        # clear stuff
        clr_character_flag = last_spell_success 
    }

    option = { name = "EVTOPT_STOP_CASTING" }
}
# Blizzard (strategic spell)
#
# selects some enemy character
#
character_event = {
    id = ice.1
    desc = "EVTDESC_ICE_1"
    picture = "GFX_spell_ice"
    is_triggered_only = yes
   
    option = {
        name = "EVTOPT_CAST_SPELL"
       #trigger = { has_character_flag = last_spell_success }
        # first select any enemy
        location = {
            add_province_modifier = { name = spell_blizzard duration = 15 }
            any_neighbor_province = {
                add_province_modifier = { name = spell_blizzard duration = 15 }
            }
        }
        # marks character that uses powerfull strategic spells
        hidden_tooltip = {
            set_character_flag = strategic_spell_used
            character_event = { id = magicengine.6 days = 15 }
        }
    }
}
# Ice Walls
character_event = {
    id = ice.2
    desc = "EVTDESC_ICE_2"
    picture = "GFX_spell_ice"
    is_triggered_only = yes
   
    option = {
        name = "EVTOPT_CAST_SPELL"
       #trigger = { has_character_flag = last_spell_success }
        # first select any enemy
        location = {
            if = { 
                limit = { is_winter = yes } 
                add_province_modifier = { name = spell_winter_realm duration = 60 }
            }
            if = { 
                limit = { is_winter = no } 
                add_province_modifier = { name = spell_winter_realm duration = 30 }
            }
        }
        # marks character that uses powerfull strategic spells
        hidden_tooltip = {
            set_character_flag = strategic_spell_used
            character_event = { id = magicengine.6 days = 15 }
        }
    }
}
#
character_event = {
    id = ice.3
    #desc = "Send hail to the enemy"
    desc = "EVTDESC_ICE_3"
    picture = "GFX_spell_ice"
    is_triggered_only = yes
   
    option = {
        name = OK
        # first select any enemy
        siege = {
            enemy = {
                troops = -0.1
                morale = -0.1
            }
        }
        # marks character that uses powerfull strategic spells
        hidden_tooltip = {
            set_character_flag = strategic_spell_used
            character_event = { id = magicengine.6 days = 15 }
        }
    }
}
character_event = {
    id = ice.4
    #desc = "Send hail to the enemy"
    desc = "EVTDESC_ICE_4"
    picture = "GFX_spell_ice"
    is_triggered_only = yes
   
    option = {
        name = OK
        # first select any enemy
        siege = {
            enemy = {
                troops = -0.04
                morale = -0.04
            }
        }
        # marks character that uses powerfull strategic spells
        hidden_tooltip = {
            set_character_flag = strategic_spell_used
            character_event = { id = magicengine.6 days = 15 }
        }
    }
}

###################################################
#
#              DUEL SPELLS
#
###################################################
#
# Duel spells doesn't have sperate events they
# are implemented in duelengine
#
# Offensive Shardstorm
# Deffensive Wall of Ice
# Buff Permafrost - movement is slower (-1 Attack for both, easier escape)
# Special Ice Maiden Kiss
